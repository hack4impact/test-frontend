'use client'

import { createContext, useState, useEffect, ReactNode, useContext } from "react";

const ScrollContext = createContext(false);

export function ScrollProvider({ children }: { children: ReactNode }) {
  const [scroll, setScroll] = useState(false);

  useEffect(() => {
    const nav = document.getElementById("nav");
    const logo = document.getElementById("logo");
    const page = document.getElementById("page");

    if (!page) return;


    function updateNav(entries: IntersectionObserverEntry[]) {

      const [entry] = entries;

      if (!entry.isIntersecting) {
        setScroll(true)
        nav?.classList.add("bg-[#0085FF]", "mt-5", "w-[calc(100% - 20px)]", "rounded-sm");
        nav?.classList.remove("bg-transparent", "w-screen");
      } else {
        setScroll(false)
        nav?.classList.remove("bg-[#0085FF]", "mt-5", "w-[calc(100% - 20px)]", "rounded-sm");
        nav?.classList.add("bg-transparent", "w-screen");
      }

    };

    const options = {
      root: null,
      rootMargin: "0px",
      threshold: 0.5
    }

    const navObserver = new IntersectionObserver(updateNav, options);

    navObserver.observe(page);

    return () => {
      navObserver.disconnect();
    };

  }, []);

  return (
    <ScrollContext value={scroll}>
      {children}
    </ScrollContext>);
}

export function useScroll() {
  const context = useContext(ScrollContext);
  if (context === undefined) {
    throw new Error('useScroll must be used within a ScrollProvider');
  }
  return context;
}
